### 1.为什么要有哨兵集群
哨兵一般是多个的，防止哨兵挂掉以及判断是否客观下线的时候，就可以就可以避免单个哨兵因为自身网络状况不好，而误判主节点下线的情况同时，多个哨兵的网络同时不稳定的概率较小，由它们一起做决策，误判率也能降低
<img width="650" height="162" alt="53c48d2fa3d8e9cd95005e75bc93c5be" src="https://github.com/user-attachments/assets/f2292b95-0e99-499b-90f5-4a442d679b8d" /><img width="650" height="162" alt="53c48d2fa3d8e9cd95005e75bc93c5be" src="https://github.com/user-attachments/assets/2e6c35ad-50fa-44ab-a747-198085a4dfeb" />### 1.哪个哨兵节点判断主节点为「客观下线」，这个哨兵节点就是候选者
候选者会向其他哨兵发送命令，表明希望成为 Leader 来执行主从切换，并让所有其他哨兵对它进行投票每个哨兵只有一次投票机会，如果用完后就不能参与投票了，可以投给自己或投给别人，但是只有候选者才能把票投给自己

那么在投票过程中，任何一个「候选者」，要满足两个条件

第一，拿到半数以上的赞成票

第二，拿到的票数同时还需要大于等于哨兵配置文件中的 quorum 值。

成为leader的哨兵负责该节点的主从切换

### 2.主从故障切换
第一步：在已下线主节点（旧主节点）属下的所有「从节点」里面，挑选出一个从节点，并将其转换为主节点。

第二步：让已下线主节点属下的所有「从节点」修改复制目标，修改为复制「新主节点」；

第三步：将新主节点的 IP 地址和信息，通过「发布者/订阅者机制」通知给客户端；

第四步：继续监视旧主节点，当这个旧主节点重新上线时，将它设置为新主节点的从节点；

在发送SLAVEOF no one命令之后，哨兵 leader 会以每秒一次的频率向被升级的从节点发送INFO命令（没进行故障转移之前，INFO命令的频率是每十秒一次），并观察命令回复中的角色信息，当被升级节命令的频率是每十秒一次），并观察命令回复中的角色信息，当被升级节

### 3.如何通知客户端主节点已经变更

<img width="643" height="657" alt="334e21723ba37590af1a5ab58cd7ba03" src="https://github.com/user-attachments/assets/baf3257f-51bf-4119-9cb9-5d63009adc85" />

### 4.哨兵节点之间如何相互感知
<img width="650" height="162" alt="53c48d2fa3d8e9cd95005e75bc93c5be" src="https://github.com/user-attachments/assets/cd6e7bb6-a6b3-469b-8218-c1426250e300" />

### 5.哨兵节点如何发现redis集群的从节点
主节点知道所有「从节点」的信息，所以哨兵会每 10 秒一次的频率向主节点发送 INFO 命令来获取所有从节点」的信息

哨兵 B 给主节点发送 INFO 命令，主节点接受到这个命令后，就会把从节点列表返回给哨兵。接着，哨兵就可以根据从节点列表中的连接信息，和每个从节点建立连接，并在这个连接上持续地对从节点进行监控
